const { GoogleGenerativeAI } = require('@google/generative-ai');

const genAI = new GoogleGenerativeAI(process.env.API_KEY);

// ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô Unagi Yondaime Kikukawa
const RESTAURANT_INFO = `
# ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô Unagi Yondaime Kikukawa ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢

## ‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ (3 ‡∏™‡∏≤‡∏Ç‡∏≤)

### 1. ‡∏™‡∏≤‡∏Ç‡∏≤ EmQuartier (‡∏™‡∏≤‡∏Ç‡∏≤‡πÅ‡∏£‡∏Å‡πÉ‡∏ô‡πÑ‡∏ó‡∏¢)
- ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ‡∏ä‡∏±‡πâ‡∏ô 6 The Helix Sky Dining, The EmQuartier, 693 Sukhumvit Road, Khlong Tan Nuea, Watthana, Bangkok 10110
- ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: 22 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2024
- ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î: ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô 10:00-22:00 ‡∏ô.
- ‡∏£‡∏ñ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤: BTS ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏û‡∏á‡∏©‡πå

### 2. ‡∏™‡∏≤‡∏Ç‡∏≤ One Bangkok
- ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: One Bangkok Entrance 3, 1st Floor The Storeys Zone, Witthayu Road, Lumphini, Pathum Wan, Bangkok 10330
- ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå: 092 249 0555
- ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î: ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô 10:00-22:00 ‡∏ô.
- ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2024

### 3. ‡∏™‡∏≤‡∏Ç‡∏≤ King Square Community Mall (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
- ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: Unit A203-1, 2nd Floor, 775 Ratchadaphisek Road, Bang Pong Pang, Yannawa, Bangkok 10120
- ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå: 065 537 9444
- ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î: ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô 11:00-21:00 ‡∏ô.
- ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: ‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô 2025

## ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå
- ‡∏°‡∏£‡∏î‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 90 ‡∏õ‡∏µ ‡∏Å‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏õ‡∏µ 1932 ‡πÇ‡∏î‡∏¢‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó Nakasho Shoten
- ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢ ‡∏Ñ‡∏∏‡∏ì Yuhei Kikukawa ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà 4
- ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• Michelin Guide ‡∏à‡∏≤‡∏Å Aichi Prefecture, Nagoya ‡πÉ‡∏ô‡∏õ‡∏µ 2015
- ‡∏°‡∏µ‡∏™‡∏≤‡∏Ç‡∏≤ 33 ‡πÅ‡∏´‡πà‡∏á‡∏ó‡∏±‡πà‡∏ß‡πÇ‡∏•‡∏Å

## ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏î‡πà‡∏ô
### ‡πÄ‡∏°‡∏ô‡∏π‡∏õ‡∏•‡∏≤‡πÑ‡∏´‡∏•‡∏´‡∏•‡∏±‡∏Å
1. ‰∏ÄÊú¨Èáç (Ippon Unagi Set) - 1,250 ‡∏ö‡∏≤‡∏ó - ‡∏õ‡∏•‡∏≤‡πÑ‡∏´‡∏•‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß‡∏ö‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô
2. „Å≤„Å§„Åæ„Å∂„Åó (Hitsumabushi) - 1,050 ‡∏ö‡∏≤‡∏ó - ‡∏Ç‡πâ‡∏≤‡∏ß‡∏õ‡∏•‡∏≤‡πÑ‡∏´‡∏•‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ô‡∏≤‡πÇ‡∏Å‡∏¢‡πà‡∏≤ ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô‡πÑ‡∏î‡πâ 3 ‡∏ß‡∏¥‡∏ò‡∏µ
3. ‰∏ÄÊú¨„Å≤„Å§„Åæ„Å∂„Åó (Ippon Hitsumabushi) - 1,290 ‡∏ö‡∏≤‡∏ó - ‡∏õ‡∏•‡∏≤‡πÑ‡∏´‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Æ‡∏¥‡∏ï‡∏™‡∏∂‡∏°‡∏≤‡∏ö‡∏∏‡∏ä‡∏¥
4. „ÅÜ„Å™‰∏º (Una Don) - 680 ‡∏ö‡∏≤‡∏ó - ‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏•‡∏≤‡πÑ‡∏´‡∏•

### ‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏±‡∏ô‡∏ä‡πå (10:00-14:00 ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤)
1. „Éü„Éã„ÅÜ„Å™‰∏º&„Åà„Å≥Â§©„Å∑„Çâ/„ÅÜ„Å©„Çì - 590 ‡∏ö‡∏≤‡∏ó
2. „Éü„Éã„ÅÜ„Å™„ÅéÊ£íÂØøÂè∏&Â§©„Å∑„Çâ„ÅÜ„Å©„Çì - 590 ‡∏ö‡∏≤‡∏ó
3. „ÅÜ„Å™„ÅéÂæ°ËÜ≥ (Unagi Gozen) - 620 ‡∏ö‡∏≤‡∏ó

### ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏î‡πá‡∏Å
„ÅäÂ≠êÊßò„Çª„ÉÉ„Éà (Kids Set) - 420 ‡∏ö‡∏≤‡∏ó

## ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
- Grab Food: https://bit.ly/4b8BHZK
- ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å LOGA App: https://www.loga.app/line/5905
- Instagram: @unagi.yondaime.kikukawa.th
- ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå: https://www.yondaimekikukawa.com/en/

## ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
- Last Order: EmQuartier ‡πÅ‡∏•‡∏∞ One Bangkok (20:00 ‡∏ô.), King Square (20:00 ‡∏ô.)
- Lunch Set: ‡∏ß‡∏±‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ 10:00-14:00 ‡∏ô.

## ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏õ‡∏•‡∏≤‡πÑ‡∏´‡∏•
- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏≤‡πÑ‡∏´‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 300 ‡∏Å‡∏£‡∏±‡∏°
- ‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ñ‡πà‡∏≤‡∏ô "binchozumi"
- ‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå: "Crispy, Soft and Melting" (‡∏Å‡∏£‡∏≠‡∏ö‡∏ô‡∏≠‡∏Å ‡∏ô‡∏∏‡πà‡∏°‡πÉ‡∏ô ‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡πÉ‡∏ô‡∏õ‡∏≤‡∏Å)
`;

class Gemini {
  constructor() {
    this.model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
  }

  isUrl(str) {
    return /^(http(s)?:\/\/)?(www\.)?[a-z0-9]+([-.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/.test(str);
  }

  getMimeType(response) {
    const contentType = response.headers["content-type"];
    return contentType ? contentType.split(';')[0] : 'application/octet-stream';
  }

  isAllowedMimes(mimeType) {
    return [
      "application/pdf",
      "image/jpeg", 
      "image/png",
      "audio/wav",
      "audio/mp3",
      "audio/x-m4a", 
      "video/mp4",
      "video/mov",
    ].includes(mimeType);
  }

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á prompt ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AI ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£
  createRestaurantAssistantPrompt(userMessage, fileContent = null) {
    const systemPrompt = `
‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô Unagi Yondaime Kikukawa ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢

‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:
- ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£ ‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡∏µ
- ‡∏û‡∏π‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡πÉ‡∏à‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏≤: ‡πÑ‡∏ó‡∏¢, ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©, ‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô (‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ)
- ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏∏‡∏†‡∏≤‡∏û‡πÄ‡∏ä‡πà‡∏ô "‡∏Ñ‡∏£‡∏±‡∏ö" (‡πÑ‡∏ó‡∏¢), "sir/ma'am" (‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©), "„Åß„Åô/„Åæ„Åô" (‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô)

‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:
1. ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô
2. ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞
3. ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ Grab Food ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
4. ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
5. ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô Hitsumabushi

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô:
${RESTAURANT_INFO}

‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö:
- ‡∏ï‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏ñ‡∏≤‡∏°
- ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
- ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÉ‡∏´‡πâ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤ "‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ú‡∏°‡∏à‡∏∞‡πÑ‡∏õ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏±‡∏ö"
- ‡πÄ‡∏™‡∏ô‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏™‡∏°‡∏≠
- ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏°‡∏ô‡∏π‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏ô‡πÉ‡∏à

‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: "${userMessage}"
`;

    let parts = [{ text: systemPrompt }];
    
    if (fileContent) {
      parts.push(fileContent);
      parts.push({ 
        text: "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á" 
      });
    }

    return parts;
  }

  async generateResponse(userMessage, fileContent = null) {
    try {
      const parts = this.createRestaurantAssistantPrompt(userMessage, fileContent);
      
      const result = await this.model.generateContent(parts);
      const response = await result.response;
      
      return response.text();
    } catch (error) {
      console.error('Gemini API error:', error);
      
      // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      return '‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏±‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏≠‡∏£‡πå 092 249 0555 (One Bangkok) ‡∏´‡∏£‡∏∑‡∏≠ 065 537 9444 (King Square) ‡∏Ñ‡∏£‡∏±‡∏ö';
    }
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  getMenuRecommendation(category = 'popular') {
    const recommendations = {
      popular: {
        th: "üç± ‡πÄ‡∏°‡∏ô‡∏π‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°:\n1. „Å≤„Å§„Åæ„Å∂„Åó (Hitsumabushi) - 1,050 ‡∏ö‡∏≤‡∏ó\n2. ‰∏ÄÊú¨Èáç (Ippon Unagi Set) - 1,250 ‡∏ö‡∏≤‡∏ó\n3. „ÅÜ„Å™‰∏º (Una Don) - 680 ‡∏ö‡∏≤‡∏ó",
        en: "üç± Popular Menu:\n1. Hitsumabushi - 1,050 THB\n2. Ippon Unagi Set - 1,250 THB\n3. Una Don - 680 THB",
        jp: "üç± ‰∫∫Ê∞ó„É°„Éã„É•„Éº:\n1. „Å≤„Å§„Åæ„Å∂„Åó - 1,050„Éê„Éº„ÉÑ\n2. ‰∏ÄÊú¨Èáç - 1,250„Éê„Éº„ÉÑ\n3. „ÅÜ„Å™‰∏º - 680„Éê„Éº„ÉÑ"
      },
      lunch: {
        th: "üçΩÔ∏è ‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏±‡∏ô‡∏ä‡πå (10:00-14:00 ‡∏ß‡∏±‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤):\n1. „Éü„Éã„ÅÜ„Å™‰∏º&„Åà„Å≥Â§©„Å∑„Çâ/„ÅÜ„Å©„Çì - 590 ‡∏ö‡∏≤‡∏ó\n2. „ÅÜ„Å™„ÅéÂæ°ËÜ≥ - 620 ‡∏ö‡∏≤‡∏ó",
        en: "üçΩÔ∏è Lunch Set (10:00-14:00 weekdays):\n1. Mini Una Don & Ebi Tempura/Udon - 590 THB\n2. Unagi Gozen - 620 THB",
        jp: "üçΩÔ∏è „É©„É≥„ÉÅ„Çª„ÉÉ„Éà (10:00-14:00 Âπ≥Êó•):\n1. „Éü„Éã„ÅÜ„Å™‰∏º&„Åà„Å≥Â§©„Å∑„Çâ/„ÅÜ„Å©„Çì - 590„Éê„Éº„ÉÑ\n2. „ÅÜ„Å™„ÅéÂæ°ËÜ≥ - 620„Éê„Éº„ÉÑ"
      }
    };

    return recommendations[category] || recommendations.popular;
  }
}

module.exports = new Gemini();